<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-nodejs-design-patterns/the-nodejs-platform" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Chapter 1. The Node.js Platform | Denis&#x27; Notes</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://antonovtinpa.github.io/notes/docs/nodejs-design-patterns/the-nodejs-platform"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Chapter 1. The Node.js Platform | Denis&#x27; Notes"><meta data-rh="true" name="description" content="Така разглеждаме въведение в Node.js, като започваме с кратко изложение на &quot;The Node Way&quot; или оновополагащата философия за използването на Node.js. В това се включва установени конвенции и практики от Node.js общността. Разбира се това са препоръки, а не закони."><meta data-rh="true" property="og:description" content="Така разглеждаме въведение в Node.js, като започваме с кратко изложение на &quot;The Node Way&quot; или оновополагащата философия за използването на Node.js. В това се включва установени конвенции и практики от Node.js общността. Разбира се това са препоръки, а не закони."><link data-rh="true" rel="icon" href="/notes/img/brackets.svg"><link data-rh="true" rel="canonical" href="https://antonovtinpa.github.io/notes/docs/nodejs-design-patterns/the-nodejs-platform"><link data-rh="true" rel="alternate" href="https://antonovtinpa.github.io/notes/docs/nodejs-design-patterns/the-nodejs-platform" hreflang="en"><link data-rh="true" rel="alternate" href="https://antonovtinpa.github.io/notes/docs/nodejs-design-patterns/the-nodejs-platform" hreflang="x-default"><link rel="stylesheet" href="/notes/assets/css/styles.e478e7bb.css">
<script src="/notes/assets/js/runtime~main.941ee3d6.js" defer="defer"></script>
<script src="/notes/assets/js/main.3314736d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/notes/"><b class="navbar__title text--truncate">Denis&#x27; Notes</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/notes/docs/intro">Documents</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/notes/docs/intro">Denis&#x27; Documents</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/notes/docs/category/system-design-volume-1">System Design Volume 1</a><button aria-label="Expand sidebar category &#x27;System Design Volume 1&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/notes/docs/category/nodejs-design-patterns">Node.js Design Patterns</a><button aria-label="Collapse sidebar category &#x27;Node.js Design Patterns&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/notes/docs/nodejs-design-patterns/the-nodejs-platform">Chapter 1. The Node.js Platform</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/docs/nodejs-design-patterns/the-module-system">Chapter 2. The Module System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/notes/docs/nodejs-design-patterns/callbacks-and-events">Chapter 3. Callbacks and Events</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/notes/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/notes/docs/category/nodejs-design-patterns"><span itemprop="name">Node.js Design Patterns</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Chapter 1. The Node.js Platform</span><meta itemprop="position" content="2"></li></ul></nav><div class="theme-doc-markdown markdown"><header><h1>Chapter 1. The Node.js Platform</h1></header><p>Така разглеждаме въведение в Node.js, като започваме с кратко изложение на &quot;The Node Way&quot; или оновополагащата философия за използването на Node.js. В това се включва установени конвенции и практики от Node.js общността. Разбира се това са препоръки, а не закони.</p>
<p>Започваме с идеята за малкото ядро. Самата Node.js платформа има за цел да е възможно най-минималистична, тоест да предлага основните задължителни функционалностти на потребителите и, това я прави много по-лесна за поддържане. В същото време тази практика предоставя възможността да развиват екосистемата на Node.js по гъвкав и креативен начин като създават собтвени модули, които да решават специфични проблеми. Тези модули могат да се използват и преизползват по лесен начин, чрез packet manager-и като npm, pnpm, yarn и т.н, това е олицетворението на DRY принципа. Тук продължаваме с приетите практики относно модулите (пакетите), които се създават. По прицип е предпоръчително те да са малки, семпли и да решават точно определен проблем (тук се хинтва принципа за single responsibility), като модулте се правят по-скоро за използване, от колкот за надграждане и разширяване. Това намалява гъвкавостта на пакета, но за сметка на това се специализара в точно определен use case, прави времето за изработка минимално и улеснява поддръжката. Посленото нещо, което е предпоръчително за изпработката на модули е това те да са възможно най-абстрактни, създаваме модула с цялата вътрешна имплементация, но отваряме семпъл лесен за използване API, с добра документация. Така намаляваме шанса за неправилно използване на пакета. Завършваме с KISS принципа, предпочитаме имплементацията да е лесна за разбиране и поддръжка, да работи правилно и да решава проблем, но не е задължително да е перфектна, перфекционизма води до overengineering.</p>
<p>Едно от основните неща, които правим на сървъра е I/O операции или така наречените input/output операции, това включва, четене от диск или от мрежата, записване на данни и много други операции. Специфичното за тях е, че повечето да много бавни, те могат да отнемат от милисекунди до цели минути. По прицнип синхронното изпълняване на такива операции е един от големите проблеми, с които се сбълкваме понеже това означата, че thread-a ни бива блокиран. Традиционно ние се справяме с този проблем, чрез използването на множество thread-ове, но както знаем JavaScript e single-threaded език. За това трябва да разгледаме как Node.js се справя с блокиращите I/O операции. Първата концепция, която трябва да разгледаме, е busy polling (busy-waiting). При този подход ние изпращаме заявка към даден ресурс (например четене на файл) и веднага получаваме отговор. Възможно е отговорът да бъде, че данните все още не са готови. В този случай ние продължаваме да &quot;питаме&quot; ресурса дали вече има резултат, докато той не бъде готов. По този начин не блокираме напълно thread-а, но постоянно хабим ресурса на процесора в проверки, което го прави изключително неефективен подход. За щастие, Node.js използва друг механизъм за справяне с проблема на блокиращите операции, наречен Event Demultiplexing. Нека първо изясним какво всъщност означава &quot;demultiplexing&quot;. Идеята идва от телекомуникациите, където:</p>
<ul>
<li><strong>Multiplexing</strong> е процесът на комбиниране на потоци от данни в един общ канал за по-ефективно пренасяне.</li>
<li><strong>Demultiplexing</strong> е обратното – разделянето на този общ канал обратно на оригиналните му отделни потоци.</li>
</ul>
<p>Node.js адаптира тази идея по следния начин - Когато Node.js трябва да изчака данни от различни ресурси, тя регистрира тези ресурси в специален компонент на операционната система, наречен Event Demultiplexer. Този компонент „изчаква“, без да изразходва излишно ресурса на процесора, докато поне един от регистрираните ресурси стане готов (например пристигат данни от http заявка или приключва файлова операция). В момента, в който това се случи, операционната система връща на Node.js информация кой точно ресурс е готов под формата на евент (това реално е процесът на <strong>demultiplexing</strong>), този евент се запазва в така нареченото Event Queue, което е част от Node.js. Всеки евент има асоцииран към себе си handler, това е важно, защото за да излезе от опашката евента трябва да бъде обработен, а това става, чрез този handler. За да управлява този процес, Node.js използва Event Loop механизъм, който постоянно проверява Event Queue-то и изпълнява съответните handler-и за евентите в опашката. По този начин Node.js може да обработва множество асинхронни операции без да блокира изпълнението на основния thread. Това е така нареченият Reactor Pattern.</p>
<p>С цел използването на Node.js в различни среди като Linux, macOS и Windows, които имат различни начини за управление на ресурси и извършване на I/O операции, към Node.js върви и така нареченият I/O engine – libuv. Това е cross-platform библиотека, която имплементира Reactor Pattern и използва Worker Pool за делегиране на по-тежки задачи като файлови операции и криптография, като сама се справя със спецификите на различните операционни системи.</p>
<p>Нужни са ни още няколко компонента за да положим фундамента на Node.js. Това е JavaScript engine-a, който изпълнява програмите ни, това V8 на Google. Трябват ни различни binding-и, които ни дават достъп до lower level функционалности. Последно, но не на последно място ни трябва фундаментална JS библиотека, чрез която да можем да извършваме базови операции.</p>
<p>Накрая ще сравним JS в браузъра и в Node.js. Първо в Node.js, нямаме DOM дърво, нямаме document обект нито window обект, за сметка на това имаме достъп до OS системи и операции. Когато пишем JS на сървъра не трябва да имаме притеснения за това в каква среда ще се изпълнява кода, по принцип имам представа за това каква ще ни е средата, докато на клиента той се изпълнява на различни браузъри и устройства, което го прави малко по-непредвидим. Има и други специфични разлики като модулните системи (CommonJS е default-a на Node.js, въпреки, че се възползва от синтаксиса на ES6 модулите), но те са по-скоро строго domain based.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/notes/docs/category/nodejs-design-patterns"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Node.js Design Patterns</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/notes/docs/nodejs-design-patterns/the-module-system"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Chapter 2. The Module System</div></a></nav></div></div></div></div></main></div></div></div></div>
</body>
</html>